var webdriver = require('selenium-webdriver');
var Chance = require('chance');
var chance = new Chance();
var async = require('async');

var SIGNUP_URL = 'http://www.nusiki.com/users/sign_up',
    PROFILE_URL = 'some_profile';

var driver = new webdriver.Builder().
    withCapabilities(webdriver.Capabilities.chrome()).
    build();

async.series([
    function(callback){
        console.log("Begin script.");
        console.log("\t--- begin signup ---");
        driver.get(SIGNUP_URL);

        var random = chance.integer({min: 0, max: 4});
        // driver.findElement(webdriver.By.id('user_username')).sendKeys(chance.word({syllables: 3}));
        if (random == 0)
            driver.findElement(webdriver.By.id('user_username')).sendKeys(chance.city() + chance.integer({min: 1, max: 99}));
        else if (random == 1)
            driver.findElement(webdriver.By.id('user_username')).sendKeys(chance.first() + chance.integer({min: 84, max: 95}));
        else if (random == 2)
            driver.findElement(webdriver.By.id('user_username')).sendKeys(chance.first() + chance.last().charAt(0));
        else
            driver.findElement(webdriver.By.id('user_username')).sendKeys(chance.first().toLowerCase() + chance.syllable());

        driver.findElement(webdriver.By.id('user_email')).sendKeys(chance.email({domain: 'gmail.com'}));
        var password = chance.word({syllables: 3}) + chance.integer({min: 1, max: 99});
        driver.findElement(webdriver.By.id('user_password')).sendKeys(password);
        driver.findElement(webdriver.By.id('user_password_confirmation')).sendKeys(password);
        driver.findElement(webdriver.By.id('user_full_name')).sendKeys(chance.name());
        driver.findElement(webdriver.By.name('commit')).click();
        callback(null);
    },
    function(callback){
        setTimeout(function(){
            console.log("\t--- done signing up ---");
            console.log("\t--- go to profile ---");
            driver.get(PROFILE_URL);
            setTimeout(function(){
                driver.findElement(webdriver.By.css('a.gallerypic')).click();
                driver.findElement(webdriver.By.css('span.glyphicon.glyphicon-star-empty')).click();
                console.log("\t--- like post ---");
                callback(null);
            }, 3000);
        }, 10000); 
    },
    function(callback){
        setTimeout(function(){
            console.log("\t--- quit the browser ---");
            driver.quit();
            callback(null);
        }, 1000);    
    }
], 
function(err) {
    console.log('Script complete.')
    if (err){
        driver.quit();
    }
});